<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
      <i class="bi bi-list-ul me-2"></i>
      Available Donations
    </h2>
    <a routerLink="/donate" class="btn btn-dark">
      <i class="bi bi-plus-circle me-2"></i>
      Offer a Donation
    </a>
  </div>
  
  <!-- Search box -->
  <div class="row mb-4">
    <div class="col-md-6 col-lg-4">
      <div class="input-group">
        <span class="input-group-text">
          <i class="bi bi-search"></i>
        </span>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search by donor name..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        />
        <button 
          class="btn btn-outline-secondary" 
          type="button" 
          (click)="clearSearch()"
          [disabled]="!searchTerm"
          title="Clear search">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <small class="text-muted" *ngIf="searchTerm">
        <i class="bi bi-info-circle me-1"></i>
        Showing results for "{{ searchTerm }}"
      </small>
    </div>
  </div>
  
  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading donations...</p>
  </div>

  <!-- No donations message -->
  <div *ngIf="!isLoading && allDonations.length === 0" class="text-center py-5">
    <div class="card bg-light">
      <div class="card-body">
        <i class="bi bi-inbox display-1 text-muted mb-3"></i>
        <h4 class="text-muted">No donations yet</h4>
        <p class="text-muted mb-4">Be the first to make a difference in your community.</p>
        <a routerLink="/donate" class="btn btn-dark">
          <i class="bi bi-plus-circle me-2"></i>
          Make Your First Donation
        </a>
      </div>
    </div>
  </div>

  <!-- No search results message -->
  <div *ngIf="!isLoading && allDonations.length > 0 && filteredDonations.length === 0" class="text-center py-5">
    <div class="card bg-light">
      <div class="card-body">
        <i class="bi bi-search display-1 text-muted mb-3"></i>
        <h4 class="text-muted">No donations found</h4>
        <p class="text-muted mb-4">
          No donations match your search for "{{ searchTerm }}".
        </p>
        <button class="btn btn-outline-secondary" (click)="clearSearch()">
          <i class="bi bi-arrow-left me-2"></i>
          Clear Search
        </button>
      </div>
    </div>
  </div>
  
  <!-- Donations grid -->
  <div *ngIf="!isLoading && filteredDonations.length > 0">
    <!-- Results info -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <small class="text-muted">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - 
        {{ getEndIndex() }} 
        of {{ filteredDonations.length }} donations
        <span *ngIf="searchTerm && filteredDonations.length !== allDonations.length">
          (filtered from {{ allDonations.length }} total)
        </span>
      </small>
      <small class="text-muted">Page {{ currentPage }} of {{ totalPages }}</small>
    </div>

    <div class="row">
      <div class="col-lg-4 col-md-6 mb-4" *ngFor="let d of donations">
        <div class="card h-100 shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">{{ d.foodType }}</h6>
            <span class="badge" [ngClass]="{
              'bg-success': d.status === 'available',
              'bg-warning text-dark': d.status === 'reserved',
              'bg-secondary': d.status === 'collected'
            }">
              {{ d.status | titlecase }}
            </span>
          </div>
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-box-seam me-2 text-secondary"></i>
              <strong>{{ d.quantity }} {{ d.unit }}</strong>
            </div>
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-person me-2 text-success"></i>
              <span>{{ d.donorName }}</span>
            </div>
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-geo-alt me-2 text-danger"></i>
              <span class="text-truncate">{{ d.location }}</span>
            </div>
            <div class="d-flex align-items-center mb-3">
              <i class="bi bi-calendar-event me-2 text-muted"></i>
              <span>Expires: {{ d.expiryDate }}</span>
            </div>
                      <div class="d-flex gap-2">
            <a [routerLink]="['/donations', d.id]" class="btn btn-outline-dark btn-sm flex-fill">
              <i class="bi bi-eye me-1"></i>
              View Details
            </a>
            <a [routerLink]="['/donations', d.id, 'edit']" class="btn btn-outline-secondary btn-sm" title="Edit donation">
              <i class="bi bi-pencil"></i>
            </a>
            <button (click)="remove(d.id)" class="btn btn-outline-danger btn-sm" title="Delete donation">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination controls -->
    <nav aria-label="Donations pagination" *ngIf="totalPages > 1">
      <ul class="pagination justify-content-center mt-4">
        <!-- Previous button -->
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
            <i class="bi bi-chevron-left"></i>
            Previous
          </button>
        </li>

        <!-- First page -->
        <li class="page-item" *ngIf="getPageNumbers()[0] > 1">
          <button class="page-link" (click)="goToPage(1)">1</button>
        </li>
        
        <!-- Ellipsis before current range -->
        <li class="page-item disabled" *ngIf="getPageNumbers()[0] > 2">
          <span class="page-link">...</span>
        </li>

        <!-- Page numbers -->
        <li class="page-item" 
            *ngFor="let page of getPageNumbers()" 
            [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
        </li>

        <!-- Ellipsis after current range -->
        <li class="page-item disabled" 
            *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1">
          <span class="page-link">...</span>
        </li>
        
        <!-- Last page -->
        <li class="page-item" 
            *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages">
          <button class="page-link" (click)="goToPage(totalPages)">{{ totalPages }}</button>
        </li>

        <!-- Next button -->
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">
            Next
            <i class="bi bi-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div> 